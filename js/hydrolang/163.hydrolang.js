export const __webpack_esm_id__=163;export const __webpack_esm_ids__=[163];export const __webpack_esm_modules__={823:(e,t,a)=>{a.d(t,{default:()=>O}),a.r(t);const o=class{constructor(e){this.apiKey=e,this.loaded=!1,window._googlemapsapi||(this.callbackName="_googlemapsapi.mapLoaded",window._googlemapsapi=this,window._googlemapsapi.mapLoaded=this.mapLoaded.bind(this))}async load(){return this.loaded?Promise.resolve():new Promise((e,t)=>{this.resolve=e,this.reject=t;const a=document.createElement("script");a.src=`https://maps.googleapis.com/maps/api/js?key=${this.apiKey}&callback=${this.callbackName}`,a.async=!0,a.defer=!0,a.onerror=()=>{this.reject(new Error("Failed to load Google Maps API"))},document.head.appendChild(a)})}mapLoaded(){this.loaded=!0,console.log("Google Maps API is loaded."),this.resolve&&this.resolve()}isLoaded(){return this.loaded}},r=class{constructor(){this.loaded=!1,window._leafletosmapi||(this.callbackname="_leafletosmapi.mapLoaded",window._leafletosmapi=this,window._leafletosmapi.mapLoaded=this.mapLoaded.bind(this))}async load(){return this.loaded?Promise.resolve():new Promise(async(e,t)=>{try{await this.loadCSS("https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"),await this.loadCSS("https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css"),await this.loadScript("https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"),console.log("Leaflet core is loaded."),await this.loadScript("https://cdnjs.cloudflare.com/ajax/libs/leaflet-plugins/3.3.1/layer/vector/KML.js"),await this.loadScript("https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"),this.loaded=!0,console.log("Leaflet and all plugins are loaded."),e()}catch(e){t(new Error(`Failed to load Leaflet: ${e.message}`))}})}async loadScript(e){return new Promise((t,a)=>{const o=document.createElement("script");o.src=e,o.async=!0,o.defer=!0,o.onload=()=>t(),o.onerror=()=>a(new Error(`Failed to load script: ${e}`)),document.head.appendChild(o)})}async loadCSS(e){return new Promise((t,a)=>{const o=document.createElement("link");o.rel="stylesheet",o.type="text/css",o.href=e,o.onload=()=>t(),o.onerror=()=>a(new Error(`Failed to load CSS: ${e}`)),document.head.appendChild(o)})}mapLoaded(){this.resolve&&this.resolve()}isLoaded(){return this.loaded}},n={OpenStreetMap:{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",options:{maxZoom:19,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}},OpenStreetMapDE:{url:"https://{s}.tile.openstreetmap.de/tiles/osmde/{z}/{x}/{y}.png",options:{maxZoom:18,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}},OpenSeaMap:{url:"https://tiles.openseamap.org/seamark/{z}/{x}/{y}.png",options:{attribution:'Map data: &copy; <a href="http://www.openseamap.org">OpenSeaMap</a> contributors'}},OpenPtMap:{url:"http://openptmap.org/tiles/{z}/{x}/{y}.png",options:{maxZoom:17,attribution:'Map data: &copy; <a href="http://www.openptmap.org">OpenPtMap</a> contributors'}},OpenTopoMap:{url:"https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",options:{maxZoom:17,attribution:'Map data: {attribution.OpenStreetMap}, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'}},OpenRailwayMap:{url:"https://{s}.tiles.openrailwaymap.org/standard/{z}/{x}/{y}.png",options:{maxZoom:19,attribution:'Map data: {attribution.OpenStreetMap} | Map style: &copy; <a href="https://www.OpenRailwayMap.org">OpenRailwayMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'}},OpenFireMap:{url:"http://openfiremap.org/hytiles/{z}/{x}/{y}.png",options:{maxZoom:19,attribution:'Map data: {attribution.OpenStreetMap} | Map style: &copy; <a href="http://www.openfiremap.org">OpenFireMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'}},SafeCast:{url:"https://s3.amazonaws.com/te512.safecast.org/{z}/{x}/{y}.png",options:{maxZoom:16,attribution:'Map data: {attribution.OpenStreetMap} | Map style: &copy; <a href="https://blog.safecast.org/about/">SafeCast</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'}},Stamen:{url:"https://stamen-tiles-{s}.a.ssl.fastly.net/{variant}/{z}/{x}/{y}{r}.{ext}",options:{attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data {attribution.OpenStreetMap}',subdomains:"abcd",minZoom:0,maxZoom:20,variant:"toner",ext:"png"}},Esri:{url:"https://server.arcgisonline.com/ArcGIS/rest/services/{variant}/MapServer/tile/{z}/{y}/{x}",options:{variant:"World_Street_Map",attribution:"Tiles &copy; Esri"}},FreeMapSK:{url:"http://t{s}.freemap.sk/T/{z}/{x}/{y}.jpeg",options:{minZoom:8,maxZoom:16,subdomains:"1234",bounds:[[47.204642,15.996093],[49.830896,22.576904]],attribution:'{attribution.OpenStreetMap}, vizualization CC-By-SA 2.0 <a href="http://freemap.sk">Freemap.sk</a>'}},MtbMap:{url:"http://tile.mtbmap.cz/mtbmap_tiles/{z}/{x}/{y}.png",options:{attribution:"{attribution.OpenStreetMap} &amp; USGS"}},OneMapSG:{url:"https://maps-{s}.onemap.sg/v3/{variant}/{z}/{x}/{y}.png",options:{variant:"Default",minZoom:11,maxZoom:18,bounds:[[1.56073,104.11475],[1.16,103.502]],attribution:'<img src="https://docs.onemap.sg/maps/images/oneMap64-01.png" style="height:20px;width:20px;"/> New OneMap | Map data &copy; contributors, <a href="http://SLA.gov.sg">Singapore Land Authority</a>'}},GeoportailFrance:{url:"https://wxs.ign.fr/{apikey}/geoportail/wmts?REQUEST=GetTile&SERVICE=WMTS&VERSION=1.0.0&STYLE={style}&TILEMATRIXSET=PM&FORMAT={format}&LAYER={variant}&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}",options:{attribution:'<a target="_blank" href="https://www.geoportail.gouv.fr/">Geoportail France</a>',bounds:[[-75,-180],[81,180]],minZoom:2,maxZoom:18,apikey:"choisirgeoportail",format:"image/jpeg",style:"normal",variant:"GEOGRAPHICALGRIDSYSTEMS.MAPS.SCAN-EXPRESS.STANDARD"}},JusticeMap:{url:"http://www.justicemap.org/tile/{size}/{variant}/{z}/{x}/{y}.png",options:{attribution:'<a href="http://www.justicemap.org/terms.php">Justice Map</a>',size:"county",bounds:[[14,-180],[72,-56]]}},NASAGIBS:{url:"https://map1.vis.earthdata.nasa.gov/wmts-webmerc/{variant}/default/{time}/{tilematrixset}{maxZoom}/{z}/{y}/{x}.{format}",options:{attribution:'Imagery provided by services from the Global Imagery Browse Services (GIBS), operated by the NASA/GSFC/Earth Science Data and Information System (<a href="https://earthdata.nasa.gov">ESDIS</a>) with funding provided by NASA/HQ.',bounds:[[-85.0511287776,-179.999999975],[85.0511287776,179.999999975]],minZoom:1,maxZoom:9,format:"jpg",time:"",tilematrixset:"GoogleMapsCompatible_Level"}},BasemapAT:{url:"https://maps{s}.wien.gv.at/basemap/{variant}/{type}/google3857/{z}/{y}/{x}.{format}",options:{maxZoom:19,attribution:'Datenquelle: <a href="https://www.basemap.at">basemap.at</a>',subdomains:["","1","2","3","4"],type:"normal",format:"png",bounds:[[46.35877,8.782379],[49.037872,17.189532]],variant:"geolandbasemap"}},mapc:{url:"http://tiles.mapc.org/basemap/{z}/{x}/{y}.png",options:{attribution:'Tiles by <a href="http://mapc.org">MAPC</a>, Data by <a href="http://mass.gov/mgis">MassGIS</a>',maxZoom:17,minZoom:9}}};var s,i,l,p,c,d=a(732),m=a(908),g=a(356),y=!1;async function u({params:e={maptype:"leaflet"},args:t={},data:a={}}={}){if("google"==e.maptype){const e=t.key,a=new o(e);await a.load()}if("leaflet"==e.maptype){const e=new r;await e.load()}}function h(e){if(s){if(i){if("google"===e){const e=document.getElementById("gmap-control-div");e&&e.remove()}else"leaflet"===e&&i.remove();i=null}"google"!==e&&"leaflet"===e&&(i=(new L.control.layers).addTo(s),Object.entries(window.baselayers).forEach(([e,t])=>{i.addBaseLayer(t,e)}),Object.entries(window.overlayers).forEach(([e,t])=>{i.addOverlay(t,e)}))}}async function f({params:e,args:t,data:a}={}){var o={};a=a||t.data,e&&e.maptype?o.maptype=e.maptype:o.maptype=void 0!==c?c:"leaflet",console.log("Layers: maptype determined as:",o.maptype);var r={type:t.type,markertype:t.markertype,geotype:t.geo,data:a||t.data,name:t.name,coord:a||t.coord,popUpContent:t.popUp||null,styleFunction:t.styleFunction||null,popUpFunction:t.popUpFunction||null,onClickFunction:t.onClickFunction||null};if(console.log("Layers: layertype constructed:",r),"georaster"===r.type&&"string"==typeof r.data){console.log("Layers: Detected GeoTIFF URL, fetching and parsing with geospatial module...");try{await g.A.load({includeGeoTIFF:!0});const e=await g.A.loadGeoTIFF(r.data),t=await S(e.data);r.data=t,a=t,console.log("Layers: GeoTIFF parsed successfully via geospatial module")}catch(e){throw console.error("Layers: Failed to load GeoTIFF from URL:",e),e}}try{if("google"===o.maptype){var m=r.type,u=r.name;if(void 0===i){!d.ux({params:{id:"gmap-control-div"}})&&d.Sw({params:{id:"gmap-control-div",style:"\n                #gmap-control-div {\n                  position: relative;\n                  width: 200px;\n                  font-family: Arial, sans-serif;\n                }\n\n                #select-box {\n                  display: flex;\n                  justify-content: space-between;\n                  align-items: center;\n                  padding: 11px 23px;\n                  border: 1px solid #ccc;\n                  cursor: pointer;\n                  text-align: left;\n                  color: rgb(0, 0, 0);\n                  font-family: Roboto, Arial, sans-serif;\n                  font-size: 18px;\n                  border-radius: 2px;\n                  box-shadow: rgba(0, 0, 0, 0.3) 0px 1px 4px -1px;\n                  background: none padding-box rgb(255, 255, 255);\n                  font-weight: bold;\n                  margin: 10px 10px 0px 0px;\n                }\n\n                #options-container {\n                  display: none;\n                  position: absolute;\n                  top: 100%;\n                  left: 0;\n                  right: 0;\n                  border: 1px solid #ccc;\n                  border-top: none;\n                  max-height: 200px;\n                  overflow-y: auto;\n                  background-color: white;\n                  margin: 0px 10px 0px 0px;\n\n                }\n\n                #options-container label {\n                  display: block;\n                  padding: 8px 10px;\n                }\n\n                #options-container label:hover {\n                  background-color: #f0f0f0;\n                }\n                  "}});let e=document.getElementById("gmap-control-div");i=e,e.innerHTML='\n            <div id="select-box">\n              <span class="selected-options">Layers</span>\n              <span class="arrow">&#9662;</span>\n            </div>\n            <div id="options-container">\n            </div>\n          ',s.controls[google.maps.ControlPosition.TOP_RIGHT].push(e);const t=document.querySelector("#select-box"),a=document.querySelector("#options-container");t.addEventListener("click",function(e){a.style.display="block"===a.style.display?"none":"block"}),a.addEventListener("change",function(e){"checkbox"===e.target.type&&(console.log(e.target.value),e.target.checked?baselayers[e.target.value].setMap(s):baselayers[e.target.value].setMap(null))})}if("marker"===m){if(!window.AdvancedMarkerElement){var{AdvancedMarkerElement:f}=await google.maps.importLibrary("marker");window.AdvancedMarkerElement=f}(M=v({params:o,args:r})).setMap(s),baselayers[u]=M,w(0,u)}else"geojson"===m?(M=b({params:o,args:r,data:r.data}),s.addLayer(M),M.setMap(s),baselayers[u]=M,w(0,u)):"georaster"===m?((M=x({params:o,args:r})).setMap(s),baselayers[u]=M,w(0,u)):"removelayers"===m&&(baselayers.hasOwnProperty(u)?(baselayers[u].setMap(null),delete baselayers[u],function(e,t){let a=document.getElementById("options-container");for(const e of a.children)e.firstChild.value===t&&e.remove()}(0,u)):console.log("there is no layer with that name!"));return M}if("leaflet"===o.maptype){var M;if(m=r.type,u=r.name,"tile"===m){let e,t;if(r.url)e=r.url,t=r.options||{};else{if(!n||!n[u])return void console.error("Layers: Invalid tile provider or layer name:",u);e=n[u].url,t=n[u].options}return M=new L.TileLayer(e,t),Object.assign(baselayers,{[u]:M}),s.addLayer(M),void 0===i?h("leaflet"):i.addBaseLayer(M,u),M}return"wms"===m?(M=L.tileLayer.wms(r.data,{layers:r.layers,format:r.format||"image/png",transparent:void 0===r.transparent||r.transparent,version:r.version||"1.1.1",attribution:r.attribution||""}),Object.assign(overlayers,{[u]:M}),s.addLayer(M),void 0===i?h("leaflet"):i.addOverlay(M,u),M):new Promise((e,t)=>{const n=async function(){try{if("geojson"===m)M=await b({params:o,args:r,data:a}),Object.assign(overlayers,{[u]:M}),s.addLayer(M),i.addOverlay(M,u);else if("marker"===m)M=v({params:o,args:r}),Object.assign(overlayers,{[u]:M}),s.addLayer(M),i.addOverlay(M,u);else if("kml"===m)M=function({params:e,args:t,data:a}={}){if("google"==e.maptype)new google.maps.KmlLayer(a,{suppressInfoWindows:!0,preserveViewport:!1,map:s}).addListener("click",function(e){var t=e.featureData.infoWindowHtml;document.getElementById("capture").innerHTML=t});else if("leaflet"==e.maptype){const e=(new DOMParser).parseFromString(a,"text/xml");return new L.KML(e)}}({params:o,data:a}),Object.assign(overlayers,{[u]:M}),i.addOverlay(M,u);else if("georaster"===m){M=await x({params:o,args:r}),Object.assign(overlayers,{[u]:M}),s.addLayer(M);try{i&&"function"==typeof i.addOverlay&&i.addOverlay(M,u)}catch(e){console.log("Controller error:",e)}}else"draw"===m?(y||(l=new L.FeatureGroup,function({params:e,args:t,data:a}={}){if("google"==e.maptype);else if("leaflet"==e.maptype){var o={position:"topleft",scale:!0,draw:{polyline:{metric:!0,shapeOptions:{color:"#3388ff",weight:4,opacity:.7}},polygon:{allowIntersection:!1,metric:!0,drawError:{color:"#ff0000",message:"<strong> You cant do that!"},shapeOptions:{color:"#3388ff",weight:4,opacity:.7,fillColor:"#3388ff",fillOpacity:.2}},rectangle:{allowIntersection:!1,metric:!0,drawError:{color:"#ff0000",message:"<strong> You cant do that!"},shapeOptions:{color:"#3388ff",weight:4,opacity:.7,fillColor:"#3388ff",fillOpacity:.2}},circle:{metric:!0,feet:!0,shapeOptions:{color:"#3388ff",weight:4,opacity:.7,fillColor:"#3388ff",fillOpacity:.2}},marker:{markerIcon:null,zIndexOffset:2e3}},edit:{featureGroup:l,remove:!0}};p=new L.Control.Draw(o),s.addControl(p),s.on("draw:created",function(e){var t=e.layerType,a=e.layer,o=a.getLatLngs();"marker"===t?a.on("click",function(){a.bindPopup(`Marker coordinates: ${o}.`)}):"rectangle"===t?a.on("click",function(){a.bindPopup(`Rectangle corners coordinates: ${o}.`)}):"circle"===t?a.on("click",function(){a.bindPopup(`Circle coordinates: ${a.getLatLng()} with radius: ${a.getRadius()}.`)}):"polygon"===t&&a.on("click",function(){a.bindPopup(`Polygon corners coordinates: ${a.getLatLngs()} with area.`)}),l.addLayer(a)})}}({params:o}),y=!0),s.addLayer(l),M=l):"removelayers"===m&&(baselayers.hasOwnProperty(u)?(s.removeLayer(baselayers[u]),i.removeLayer(baselayers[u]),delete baselayers[u]):overlayers.hasOwnProperty(u)?(s.removeLayer(overlayers[u]),i.removeLayer(overlayers[u]),delete overlayers[u]):"map"===u?s.remove():"draw"===u&&p.remove());e(M)}catch(e){console.error("Layers: Error processing layer:",e),t(e)}};s&&s._loaded?n():s.whenReady(n)})}}catch(e){console.error("There was an error when generating the map",e)}}function w(e,t){document.getElementById("options-container").innerHTML+=`\n      <label><input type="checkbox" value="${t}" checked="true">${t}</label>\n    `}async function b({params:e,args:t,data:a}={}){let o,{styleFunction:r,popUpFunction:n,onClickFunction:i}=t;if(console.log("data",a),"FeatureCollection"===a.type?o=a.features[0].geometry.type:"Feature"===a.type&&(o=a.geometry.type),"google"===e.maptype){const e=new google.maps.Data,t=new google.maps.InfoWindow;let l;const p={scale:5,fillColor:"red",color:"#0dc1d3",weight:1,opacity:1,fillOpacity:.6,strokeWeight:.7},c={fillColor:"#2ce4f3",color:"#0dc1d3",weight:1,opacity:1,fillOpacity:.6};if("Point"===o)return e.addGeoJson(a),e.setStyle(function(e){return{map:s,center:e.getGeometry().get(),icon:{path:google.maps.SymbolPath.CIRCLE,...r?r(e):p}}}),e.addListener("click",function(e){l=n?n(e.feature):`<div>Coordinates: ${e.latLng}</div>`,t.setContent(l),t.setPosition(e.feature.getGeometry().get()),t.open(s),i&&i(e)}),e;if("Polygon"===o||"MultiPolygon"===o)return e.addGeoJson(a),e.setStyle(function(e){return{map:s,...r?r(e):c}}),e.addListener("click",function(e){n&&(l=n(e.feature)),console.log(e.feature.getGeometry()),t.setContent(l),t.setPosition(e.latLng),t.open(s),i&&i(e.feature.Gg)}),e}else if("leaflet"===e.maptype){const e=(e,t)=>{n?t.bindPopup(n(e)):e.properties&&e.properties.Name&&e.properties.Lat&&e.properties.Lon&&t.bindPopup(`${e.properties.Name} (${e.properties.Lat}, ${e.properties.Lon})`),i&&t.on("click",i)},t={weight:2,color:"#432"};if("Point"===o)return L.geoJSON(a);if("Polygon"===o||"MultiPolygon"===o)return L.geoJSON(a,{style:function(e){return null!==r?r(e):t},onEachFeature:e})}}function v({params:e,args:t,data:a}={}){var o,r,n=t.markertype,i=t.coord,l=t.name;if(console.log("addMarker called with:",{maptype:e.maptype,markertype:n,coord:i}),"google"===e.maptype)switch(n){case"marker":o=new AdvancedMarkerElement({position:{lat:i[0],lng:i[1]},title:l});var p=new google.maps.InfoWindow;!function(e,t,a,o){google.maps.event.addListener(o,"click",function(){t.setContent(a),t.open(e,o)})}(s,p,t.popUpContent||`Coordinates: lat: ${i[0]}, lon: ${i[1]}`,o);break;case"rectangle":o=new google.maps.Rectangle({...C({params:{map:"google",fig:"rectangle"}}),bounds:{north:i[0]+.01,south:i[0]-.01,east:i[1]+.01,west:i[1]-.01}});break;case"circle":o=new google.maps.Circle({...C({params:{map:"google",fig:"circle"}}),center:{lat:i[0],lng:i[1]}});break;case"polyline":r=i.map(([e,t])=>({lat:e,lng:t})),o=new google.maps.Polyline({path:r,geodesic:!0,...C({params:{map:"google",fig:"polyline"}})});case"polygon":r=i.map(([e,t])=>({lat:e,lng:t})),o=new google.maps.Polygon({path:r,geodesic:!0,...C({params:{map:"google",fig:"polygon"}})})}if("leaflet"===e.maptype)switch(n){case"rectangle":o=new L.rectangle(i,C({params:{map:"leaflet",fig:"rectangle"}}));break;case"circle":o=new L.circle(i,C({params:{map:"leaflet",fig:"circle"}}));break;case"circlemarker":o=new L.circleMarker(i,C({params:{map:"leaflet",fig:"circlemarker"}}));break;case"polyline":o=new L.polyline(i,C({params:{map:"leaflet",fig:"polyline"}}));break;case"polygon":o=new L.polygon(i,C({params:{map:"leaflet",fig:"polygon"}}));break;case"marker":o=new L.marker(i,C({params:{map:"leaflet",fig:"marker"}})).bindPopup(t.popUpContent||`Coordinates: lat: ${i[0]}, lon: ${i[1]}`);break;default:alert("no markers with that name")}return o}async function x({params:e={},args:t,data:a}={}){let{name:o,styleOptions:r={}}=t,n=a;const l=e.maptype||"leaflet";if(console.log("addGeoRasterLayer called with:",{maptype:l,hasGeoraster:!!n,georasterKeys:n?Object.keys(n):null}),!n)throw new Error("Georaster data is required for georaster layer");if(n instanceof ArrayBuffer||n.buffer instanceof ArrayBuffer){console.log("Detected ArrayBuffer input, parsing as GeoTIFF...");try{await g.A.load({includeGeoTIFF:!0});const e=n instanceof ArrayBuffer?n:n.buffer,t=await g.A.loadGeoTIFFFromBuffer(e);n=await S(t.data),console.log("Successfully parsed ArrayBuffer to GeoRaster object")}catch(e){throw console.error("Failed to parse ArrayBuffer as GeoTIFF:",e),new Error("Failed to parse input data as valid GeoTIFF/GeoRaster")}}if(s||console.warn("Map instance (osmap) not found. Layer created but not added to map."),"google"===l){console.log("Creating Google Maps georaster layer");const e=function(e,t={}){const{opacity:a=.7,colorScheme:o="terrain"}=t;class r extends google.maps.OverlayView{constructor(e,t={}){super(),this.georaster=e,this.opacity=t.opacity||.7,this.colorScheme=t.colorScheme||"terrain",this.canvas=null}onAdd(){this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.opacity=this.opacity,this.getPanes().overlayLayer.appendChild(this.canvas),this.draw()}draw(){if(!this.canvas)return;const e=this.getProjection();if(!e)return;const t=new google.maps.LatLngBounds(new google.maps.LatLng(this.georaster.ymin,this.georaster.xmin),new google.maps.LatLng(this.georaster.ymax,this.georaster.xmax)),a=e.fromLatLngToDivPixel(t.getSouthWest()),o=e.fromLatLngToDivPixel(t.getNorthEast());this.canvas.style.left=a.x+"px",this.canvas.style.top=o.y+"px",this.canvas.style.width=o.x-a.x+"px",this.canvas.style.height=a.y-o.y+"px",this.canvas.width=o.x-a.x,this.canvas.height=a.y-o.y,this.renderElevationData()}renderElevationData(){const e=this.canvas.getContext("2d"),t=e.createImageData(this.canvas.width,this.canvas.height),a=t.data,{values:o,mins:r,maxs:n,noDataValue:s}=this.georaster,i=o[0],l=r[0],p=n[0];for(let e=0;e<this.canvas.height;e++)for(let t=0;t<this.canvas.width;t++){const o=4*(e*this.canvas.width+t),r=Math.floor(t/this.canvas.width*this.georaster.width),n=Math.floor(e/this.canvas.height*this.georaster.height),c=i[n]?.[r];if(c!==s&&Number.isFinite(c)){const e=(c-l)/(p-l),t=this.getColorForElevation(e);a[o]=t.r,a[o+1]=t.g,a[o+2]=t.b,a[o+3]=255}else a[o]=0,a[o+1]=0,a[o+2]=0,a[o+3]=0}e.putImageData(t,0,0)}getColorForElevation(e){if("terrain"===this.colorScheme)return e<.2?{r:0,g:100,b:0}:e<.4?{r:34,g:139,b:34}:e<.6?{r:255,g:255,b:0}:e<.8?{r:255,g:165,b:0}:{r:139,g:69,b:19};const t=Math.floor(255*e);return{r:t,g:t,b:t}}onRemove(){this.canvas&&this.canvas.parentNode&&(this.canvas.parentNode.removeChild(this.canvas),this.canvas=null)}}return new r(e,{opacity:a,colorScheme:o})}(n,r);return s&&e.setMap(s),e}if("leaflet"===l){n&&n.georaster&&(n=n.georaster);const e=await async function(e,t={}){const{opacity:a=.7,colorScheme:o="terrain"}=t;if(e._isGeorasterObject)return console.log("Detecting custom georaster object, using simple overlay fallback..."),M(e,{opacity:a,colorScheme:o});if(void 0!==L.GeoRasterLayer)return new L.GeoRasterLayer({georaster:e,opacity:a,resolution:256,pixelValuesToColorFn:function(t){const a=t[0],{mins:r,maxs:n,noDataValue:s}=e;return a!==s&&Number.isFinite(a)?k((a-r[0])/(n[0]-r[0]),o):null}});try{if(console.log("Attempting to load GeoRasterLayer plugin..."),await async function(){if(void 0===L.GeoRasterLayer)try{const e=document.createElement("script");return e.src="https://unpkg.com/georaster-layer-for-leaflet@3.5.0/dist/georaster-layer-for-leaflet.min.js",e.type="text/javascript",new Promise((t,a)=>{e.onload=()=>{console.log("GeoRasterLayer plugin loaded"),t()},e.onerror=()=>{a(new Error("Failed to load GeoRasterLayer plugin"))},document.head.appendChild(e)})}catch(e){throw new Error(`GeoRasterLayer plugin loading failed: ${e.message}`)}}(),void 0!==L.GeoRasterLayer)return console.log("GeoRasterLayer plugin loaded successfully"),new L.GeoRasterLayer({georaster:e,opacity:a,resolution:256,pixelValuesToColorFn:function(t){const a=t[0],{mins:r,maxs:n,noDataValue:s}=e;return a!==s&&Number.isFinite(a)?k((a-r[0])/(n[0]-r[0]),o):null}})}catch(e){console.log("GeoRasterLayer plugin not available, using canvas fallback:",e.message)}try{return console.log("Using simple GeoRaster overlay fallback..."),M(e,{opacity:a,colorScheme:o})}catch(e){console.log("Simple overlay failed, using canvas fallback:",e.message)}return function(e,t={}){const{opacity:a=.7,colorScheme:o="terrain"}=t,r=L.GridLayer.extend({options:{opacity:a,colorScheme:o},initialize:function(e,t){this.georaster=e,L.GridLayer.prototype.initialize.call(this,t)}});return new r(e,t)}(e,{opacity:a,colorScheme:o})}(n,r);if(s&&(e.addTo(s),i&&"function"==typeof i.addOverlay)){const t=o||`Raster Layer ${Math.floor(1e3*Math.random())}`;i.addOverlay(e,t),"undefined"!=typeof window&&window.overlayers&&(window.overlayers[t]=e)}return e}throw new Error(`Unsupported map type for georaster: ${l}`)}function M(e,t={}){const{opacity:a=.7,colorScheme:o="terrain"}=t;if(!e.width||!e.height)throw console.error("Invalid georaster dimensions:",e),new Error("Georaster dimensions are missing or invalid");const r=document.createElement("canvas"),n=r.getContext("2d");r.width=e.width,r.height=e.height;const s=n.createImageData(e.width,e.height),i=s.data;let l;if(e.values&&e.values[0])l=e.values[0];else{if(!e.values||!Array.isArray(e.values))throw new Error("Georaster values not found or in unexpected format");l=e.values}const{mins:p,maxs:c,noDataValue:d}=e;for(let t=0;t<e.height;t++)for(let r=0;r<e.width;r++){const n=4*(t*e.width+r),s=l[t][r];if(s!==d&&Number.isFinite(s)){const e=k((s-p[0])/(c[0]-p[0]),o);i[n]=e.r,i[n+1]=e.g,i[n+2]=e.b,i[n+3]=Math.floor(255*a)}else i[n]=0,i[n+1]=0,i[n+2]=0,i[n+3]=0}n.putImageData(s,0,0);const m=r.toDataURL(),g=[[Math.min(e.ymin,e.ymax),Math.min(e.xmin,e.xmax)],[Math.max(e.ymin,e.ymax),Math.max(e.xmin,e.xmax)]];if(!g||2!==g.length||!Array.isArray(g[0])||!Array.isArray(g[1])||2!==g[0].length||2!==g[1].length)throw new Error("Invalid georaster bounds");const[y,u]=g[0],[h,f]=g[1];if(isNaN(y)||isNaN(u)||isNaN(h)||isNaN(f))throw new Error("Georaster bounds contain invalid coordinate values");if(y<-90.01||y>90.01||h<-90.01||h>90.01||u<-180.01||u>180.01||f<-180.01||f>180.01)throw new Error(`Georaster bounds contain out-of-range coordinate values: [[${y}, ${u}], [${h}, ${f}]]`);return g[0][0]=Math.max(-90,Math.min(90,g[0][0])),g[0][1]=Math.max(-180,Math.min(180,g[0][1])),g[1][0]=Math.max(-90,Math.min(90,g[1][0])),g[1][1]=Math.max(-180,Math.min(180,g[1][1])),L.imageOverlay(m,g,{opacity:a,interactive:!1})}function k(e,t){if("terrain"===t)return e<.2?{r:0,g:100,b:0}:e<.4?{r:34,g:139,b:34}:e<.6?{r:255,g:255,b:0}:e<.8?{r:255,g:165,b:0}:{r:139,g:69,b:19};const a=Math.floor(255*e);return{r:a,g:a,b:a}}async function S(e){const t=await e.getImage(),a=t.getWidth(),o=t.getHeight(),r=await t.readRasters(),n=[],s=[],i=[],l=r.length,p=[];for(let e=0;e<l;e++){const t=r[e];let l=1/0,c=-1/0;const d=[];for(let e=0;e<o;e++){const o=[];for(let r=0;r<a;r++){const n=t[e*a+r];o.push(n),n>c&&(c=n),n<l&&(l=n)}d.push(o)}p.push(d),n.push(l),s.push(c),i.push(c-l)}const c=t.getOrigin(),d=t.getResolution();let m=c[0],y=c[1];const u=d[0],h=Math.abs(d[1]);let f=m+a*u,w=y-o*h;const b=t.getGeoKeys();let v=4326;if(b&&(v=b.ProjectedCSTypeGeoKey||b.GeographicTypeGeoKey||4326),console.log(`Parsed GeoTIFF: Projection=${v}, Raw Bounds=[${m}, ${w}, ${f}, ${y}]`),(Math.abs(m)>180||Math.abs(y)>90)&&4326!==v&&g.A.isLoaded()){console.log("Detected projected coordinates. Attempting reprojection to WGS84...");try{const e=`EPSG:${v}`,t="EPSG:4326",a=g.A.transformCoordinates([m,w],e,t),o=g.A.transformCoordinates([f,y],e,t);m=a[0],w=a[1],f=o[0],y=o[1],console.log(`Reprojected Bounds to WGS84: [${m}, ${w}, ${f}, ${y}]`)}catch(e){console.warn("Failed to reproject GeoTIFF bounds:",e)}}return{width:a,height:o,values:p,pixelWidth:u,pixelHeight:h,xmin:m,xmax:f,ymin:w,ymax:y,noDataValue:null,numberOfRasters:l,projection:v,_isGeorasterObject:!0,mins:n,maxs:s,ranges:i}}function C({params:e,args:t,data:a}={}){var o,r=e.map,n=e.fig;if("google"===r)switch(n){case"rectangle":return{strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillOpacity:.5,fillColor:"#800080",strokeColor:"#800080"};case"circle":return{strokeOpacity:.8,strokeWeight:2,fillOpacity:.5,fillColor:"#3CB043",strokeColor:"#3CB043",radius:1e3};case"polyline":return{strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2};case"polygon":return{strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35}}if("leaflet"===r)switch(n){case"rectangle":o={weight:2,color:"#e1e1100"};break;case"circle":o={radius:200,fillColor:"#2ce4f3",color:"#0dc1d3",weight:1,opacity:1,fillOpacity:.6};break;case"circlemarker":o={radius:5,fillColor:"#2ce4f3",color:"#0dc1d3",weight:1,opacity:1,fillOpacity:.6};break;case"polyline":o={weight:1,color:"#432",opacity:1};break;case"polygon":o={weight:2,color:"#e1e1100",opacity:1};break;case"marker":o={markerIcon:null,zIndexOffset:2e3}}return o}window.baselayers={},window.overlayers={},window.usedColors=new Set;const O={loader:u,Layers:f,renderMap:async function({params:e={},args:t={},data:a}={}){await Promise.resolve(u({params:e,args:t}));var o,{maptype:r="leaflet",lat:i=41.6572,lon:l=-91.5414}=e;let p={maptype:r,lat:i,lon:l,zoom:10};var m;if(!d.ux({params:{id:"map"}})&&d.Sw({params:{id:"map",style:`\n        #map {\n          height: 400px;\n          width: 800px;\n          margin-left: auto;\n          margin-right: auto;\n          position: ${"leaflet"===r?"fixed":"absolute"};\n          min-width: 200px;\n          min-height: 200px;\n        }\n      \n        .content {\n          max-width: 900px;\n          margin: auto\n        }\n        `}}),m=document.getElementById("map"),"google"===p.maptype){const e={mapTypeId:"terrain",zoom:p.zoom,center:{lat:p.lat,lng:p.lon},mapId:"MAP_ID"};c="google",s=new google.maps.Map(m,e)}else if("leaflet"===p.maptype){let{type:e="tile",name:a="OpenStreetMap"}=t;o={...t,type:e,name:a},c="leaflet",s=new L.map(m.id);const r=o.name;if("tile"===r&&!n.hasOwnProperty(r))return void console.log("No tile found!");s.setView([p.lat,p.lon],p.zoom),f({params:p,args:o});var g=new L.popup;s.on("click",e=>{g.setLatLng(e.latlng).setContent(`You clicked the map at ${e.latlng.toString()}`).openOn(s)})}},recenter:async function({params:e,args:t,data:a}={}){let o=L.latLng(t.lat,t.lon);var r=o.toBounds(12e3);s.panTo(o).fitBounds(r)},addCustomLegend:async function({params:e,args:t,data:a}={}){const{position:o}=e,{div:r}=t;if(!r)return"Pass in a div for overlay";let n=c;if(console.log("mapType",n),"google"===n)switch(o){case"top":s.controls[google.maps.ControlPosition.TOP_CENTER].push(r);break;case"top left":s.controls[google.maps.ControlPosition.TOP_LEFT].push(r);break;case"left":s.controls[google.maps.ControlPosition.LEFT_CENTER].push(r);break;case"bottom left":s.controls[google.maps.ControlPosition.BOTTOM_LEFT].push(r);break;case"bottom":s.controls[google.maps.ControlPosition.BOTTOM_CENTER].push(r);break;case"bottom right":s.controls[google.maps.ControlPosition.BOTTOM_RIGHT].push(r);break;case"right":s.controls[google.maps.ControlPosition.RIGHT_CENTER].push(r);break;case"top right":s.controls[google.maps.ControlPosition.TOP_RIGHT].push(r);break;default:console.log("Possible values for position are 'top', 'left', 'bottom', 'right', 'top left', 'top right', 'bottom left', 'bottom right'")}else if("leaflet"===n){let{position:a}=e;if(a=a.replace(" ",""),"topleft"===a||"topright"===a||"bottomleft"===a||"bottomright"===a){const e=L.control({position:a});e.onAdd=function(e){let a=L.DomUtil.create("div","legend-container");return console.log(r),a.innerHTML=t.div.innerHTML,a},e.addTo(s)}else console.log("Possible values for position are 'top left', 'top right', 'bottom left' or 'bottom right'")}else console.log("Error: map not found")},addGeoRasterLayer:x,removeMap:function(){s&&(s.remove(),s=null,i=null,window.baselayers={},window.overlayers={},window.usedColors=new Set)},reinitializeController:h,addPopup:function({params:e,args:t,data:a}={}){const{type:o="text",name:r}=e,{layer:n,chartOptions:s={}}=t;if(!n)throw new Error("addPopup: Layer is required");if("function"!=typeof n.bindPopup)throw new Error("addPopup: Layer does not support bindPopup (Google Maps not currently supported)");if("chart"===o){const e=`popup-chart-${Date.now()}-${Math.floor(1e3*Math.random())}`;let t='<div class="popup-content" style="min-width: 300px; min-height: 200px;">';r&&(t+=`<h3>${r}</h3>`),t+=`<div id="${e}" style="width: 100%; height: 200px;">Loading chart...</div>`,t+="</div>",n.bindPopup(t),n.on("popupopen",()=>{setTimeout(()=>{const t=document.getElementById(e);t&&(t.innerHTML="",m.draw({params:{type:"chart",id:e,...s},args:s,data:a}))},100)})}else if("html"===o||"text"===o){let e=a;r&&(e=`<h3>${r}</h3><div>${a}</div>`),n.bindPopup(e)}},getMap:function(){return s}}}};