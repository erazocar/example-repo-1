export const __webpack_esm_id__=56;export const __webpack_esm_ids__=[56];export const __webpack_esm_modules__={205:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{default:()=>floodDM});var _data_datasources_proxy_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(670),_data_data_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(243),_map_map_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(823);class floodDM{city="";depth=0;mapRendered=!1;selectedfeature=null;async initDamageScenario({params:e,args:t,data:a}={}){let{city:r,depth:o,scenario:s}=t;if(this.city=r,this.depth=o,void 0===e?(this.maptype="leaflet",e={}):void 0===e.maptype?this.maptype="leaflet":this.maptype=e.maptype,"google"===this.maptype&&void 0===e.key)return void console.log("param.key value is required to render a google map");if("100-year"===s)s="x100_year";else{if("500-year"!==s)return void console.log("Pass 100-year or 500-year flood scenario in the args.scenario");s="x500_year"}this.scenario=s;let n,i=await(0,_data_data_js__WEBPACK_IMPORTED_MODULE_1__.Je)({params:{source:"flooddamage_dt",datatype:s,transform:"eval"},args:{sourceType:this.city}});"Cedar Falls"===this.city&&(n=await(0,_data_data_js__WEBPACK_IMPORTED_MODULE_1__.Je)({params:{source:"flooddamage_dt",datatype:"utilities",transform:"eval"},args:{sourceType:this.city}}));let l,c=await(0,_data_data_js__WEBPACK_IMPORTED_MODULE_1__.Je)({params:{source:"flooddamage_dt",datatype:"vehicles",transform:"eval"},args:{sourceType:this.city}}),p=await(0,_data_data_js__WEBPACK_IMPORTED_MODULE_1__.Je)({params:{source:"flooddamage_dt",datatype:"buildings",transform:"eval"},args:{sourceType:this.city}});"Cedar Falls"!==this.city&&"Cedar Rapids"!==this.city&&"Davenport"!==this.city&&"Waverly"!==this.city||(l=await(0,_data_data_js__WEBPACK_IMPORTED_MODULE_1__.Je)({params:{source:"flooddamage_dt",datatype:"bridges",transform:"eval"},args:{sourceType:this.city}}));let d=floodDM.featureCollectionCentroid(p);this.mapRendered||(await(0,_map_map_js__WEBPACK_IMPORTED_MODULE_2__.renderMap)({params:{maptype:this.maptype,lat:d[1],lon:d[0]},args:{key:e.key}}),this.mapRendered=!0);let _={Buildings:{Structure:0,Content:0,Income:0,Wage:0,"Relocation Expenses":0,"Rental Income":0,"Loss of Life (Day)":0,"Loss of Life (Night)":0,Debris:0},Vehicles:{Day:0,Night:0},Bridges:{Damage:0},Utilities:{Damage:0}},u={},y=await floodDM.getVehicleDamageFunction();await(0,_map_map_js__WEBPACK_IMPORTED_MODULE_2__.Layers)({args:{type:"geojson",name:"Vehicles Layer",styleFunction:e=>{let t;"google"===this.maptype?(t={},e.forEachProperty(function(e,a){t[a]=e})):"leaflet"===this.maptype&&(t=e.properties);let a,r,o,s,n,i=t.flood100_avg,l=t.flood500_avg,c=t.area_fe_100yr,p=t.area_fe_500yr,d="PassengerCar",f="LightTruck",g="HeavyTruck";"x100_year"===this.scenario?(a=i,r=c):"x500_year"===this.scenario&&(a=l,r=p);for(let e in y[d])y[d][e].floodDepth==a&&(o=y[d][e].damage);for(let e in y[f])y[f][e].floodDepth==a&&(s=y[f][e].damage);for(let e in y[g])y[g][e].floodDepth==a&&(n=y[g][e].damage);let h=parseInt(o/100*r*t.car_val_day).toLocaleString(),m=parseInt(s/100*r*t.light_val_day).toLocaleString(),D=parseInt(n/100*r*t.heavy_val_day).toLocaleString(),b=parseInt(o/100*r*t.car_val_night).toLocaleString(),E=parseInt(s/100*r*t.light_val_night).toLocaleString(),M=parseInt(n/100*r*t.heavy_val_night).toLocaleString(),P=o/100*r*t.car_val_day+s/100*r*t.light_val_day+n/100*r*t.heavy_val_day,w=o/100*r*t.car_val_night+s/100*r*t.light_val_night+n/100*r*t.heavy_val_night;return isNaN(P)||(_.Vehicles.Day+=P),isNaN(w)||(_.Vehicles.Night+=w),u[t.CensusBloc]={"Block Information":t.CensusBloc,"Flood Scenario:":this.scenario,"Avg. Flood Depth:":a,"Car Count (Day):":t.cars_day,"Car Count (Night):":t.cars_night,"Light Truck Count (Day)":t.light_day,"Light Truck Count (Night)":t.light_night,"Heavy Truck Count (Day)":t.heavy_day,"Heavy Truck Count (Night)":t.heavy_night,"Cars Damage (Day)":h,"Cars Damage (Night)":b,"Light Trucks (Day)":m,"Light Trucks (Night)":E,"Heavy Trucks (Day)":D,"Heavy Truck (Night)":M},{fillColor:P>1e6?"#323232":P>1e5?"#7E7E7E":"#BFBFBF",weight:2,opacity:1,color:"black",dashArray:"3",fillOpacity:.9}},popUpFunction:e=>{let t;return"google"===this.maptype?(t={},e.forEachProperty(function(e,a){t[a]=e})):"leaflet"===this.maptype&&(t=e.properties),JSON.stringify(u[t.CensusBloc]).replaceAll(",","<br>").replaceAll(/|{|}/g,"")}},data:c}),await(0,_map_map_js__WEBPACK_IMPORTED_MODULE_2__.Layers)({args:{type:"geojson",name:"Flood Inundation Layer",styleFunction:e=>({color:"blue",weight:1,opacity:1,fillColor:"blue",fillOpacity:.5})},data:i});let f=[],g=await floodDM.getPropertyDamageFunction(),h=await floodDM.getLifeLossFunction(),m=await floodDM.getDebrisWeightFunction();if(await(0,_map_map_js__WEBPACK_IMPORTED_MODULE_2__.Layers)({args:{type:"geojson",name:"Properties Layer",styleFunction:e=>{let t;"google"===this.maptype?(t={},e.forEachProperty(function(e,a){t[a]=e})):"leaflet"===this.maptype&&(t=e.properties);let a,r,o=t.occupancy,n="x100_year"===s?t.depth100:t.depth500,i=g[o].find(e=>e.floodDepth===n),l=i.structure,c=i.content,p=i.recapturFactor,d=i.incomePerSqftPerDay,u=i.maxTime,y=i.recapturFactor,D=i.wagePerSqftPerDay,b=i.percentOwnerOccupied,E=i.rentalCostPerSqftPerDay,M=i.disruptionCostPerSqft;i.structure>10?(a=[(1-b/100)*M+b/100*(M+E*u*30)],r=(1-b/100)*E*u*30):(a=0,r=0);let P=t.val_struct*l/100,w=t.val_cont*c/100,O=(1-p)*t.sqfoot*d*u*30,x=(1-y)*t.sqfoot*D*u*30,C=t.sqfoot*a,v=t.sqfoot*r,L=P+w+O+x+C+v;isNaN(P)||(_.Buildings.Structure+=P),isNaN(w)||(_.Buildings.Content+=w),isNaN(O)||(_.Buildings.Income+=O),isNaN(x)||(_.Buildings.Wage+=x),isNaN(C)||(_.Buildings["Relocation Expenses"]+=C),isNaN(v)||(_.Buildings["Rental Income"]+=v);let U=h[o].find(e=>e.floodDepth===n&&"over 65"===e.age),A=h[o].find(e=>e.floodDepth===n&&"under 65"===e.age),j=U.zone*t.POP_O65DAY+A.zone*t.POP_U65DAY,T=U.zone*t.POP_O65NGT+A.zone*t.POP_U65NGT;isNaN(j)||(_.Buildings["Loss of Life (Day)"]+=j),isNaN(T)||(_.Buildings["Loss of Life (Night)"]+=T);let B=m[o].find(e=>e.floodDepth==n&&"footing"==e.foundationType),S=B.finishes+B.structure+B.foundation,k=t.sqfoot*S/1e3;if(isNaN(k)||(_.Buildings.Debris+=k),f.push({occupancy:o,gid:t.gid,totalDamageBuild:L,strDamage:P,contDamage:w,incomeLoss:O,wageLoss:x,relocationExpenses:C,rentalIncomeLoss:v,debrisAmount:k,lifeLossDay:j,lifeLossNight:T,inundationDepth:n}),"x100_year"===s){if(t.depth100<1)return{display:"none",color:"none",fillColor:"none"}}else if(t.depth500<1)return{display:"none",color:"none",fillColor:"none"};return{fillColor:L>1e6?"red":L>1e5?"yellow":"green",weight:2,opacity:1,color:"black",fillOpacity:1,radius:4,scale:4,strokeWeight:.7}},popUpFunction:e=>{let t;return"google"===this.maptype?(t={},e.forEachProperty(function(e,a){t[a]=e})):"leaflet"===this.maptype&&(t=e.properties),JSON.stringify(f.find(e=>e.gid===t.gid)).replaceAll(",","<br>").replaceAll(/|{|}/g,"")}},data:p}),"Cedar Falls"===this.city||"Cedar Rapids"===this.city||"Davenport"===this.city||"Waverly"===this.city){let e=await floodDM.getBridgeDamageFunction();await(0,_map_map_js__WEBPACK_IMPORTED_MODULE_2__.Layers)({args:{type:"geojson",name:"Bridge Layer",styleFunction:t=>{let a,r,o,n,i;"google"===this.maptype?(a={},t.forEachProperty(function(e,t){a[t]=e})):"leaflet"===this.maptype&&(a=t.properties);let l=a.bridgeT,c=String(a.ScourIndex),p=a.Cost,d=a.flood100;a.flood500,r="x100_year"===s?"100-year":"500-year","100-yr"===r&&"yes"===d?n="100 yr":"500-yr"===r?n="500 yr":o=0;for(let t in e[l])e[l][t].ScourPotential==c&&e[l][t]["Flood Scenario"]==n&&(i=e[l][t]["damage prcnt"]);return o=i*p*1e3,isNaN(o)||(_.Bridges.Damage+=o),{scale:5,radius:2,weight:10,fillColor:"black",color:"black",fillOpacity:.5,strokeWeight:.7}},popUpFunction:t=>{let a;"google"===this.maptype?(a={},t.forEachProperty(function(e,t){a[t]=e})):"leaflet"===this.maptype&&(a=t.properties),console.log(t);let r,o,n,i,l,c=a.bridgeT,p=String(a.ScourIndex),d=a.Cost,_=a.flood100;a.flood500,r="x100_year"===s?"100-year":"500-year","100-yr"===r&&"yes"===_?n="100 yr":"500-yr"===r?n="500 yr":o=0;for(let t in e[c])e[c][t].ScourPotential==p&&e[c][t]["Flood Scenario"]==n&&(i=e[c][t]["damage prcnt"],l=e[c][t].functional);return o=i*d*1e3,JSON.stringify({Bridge_ID:a.HighwayBri,Bridge_Type:c,Scour_Index:p,Flood_Scenario:n,Damage:100*i,Damage:parseInt(o).toLocaleString(),Functionality:parseInt(100*l)}).replaceAll(",","<br>").replaceAll(/|{|}/g,"")}},data:l})}if("Cedar Falls"===this.city){let e=await floodDM.getUtilityDamageFunction();await(0,_map_map_js__WEBPACK_IMPORTED_MODULE_2__.Layers)({args:{type:"geojson",name:"Utilities Layer",styleFunction:t=>{let a;"google"===this.maptype?(a={},t.forEachProperty(function(e,t){a[t]=e})):"leaflet"===this.maptype&&(a=t.properties);let r,o,s,n=0,i=a.depth100,l=a.depth500,c=a.UtilFcltyC,p=a.Cost,d=this.scenario;"x100_year"===d?r=i:"x500_year"===d&&(r=l);for(let t in e[c])e[c][t].floodDepth===r&&(s=e[c][t].damage,o=e[c][t].utilitySystem);return n=s/100*p*1e3,isNaN(n)||(_.Utilities.Damage+=n),{scale:2,radius:2,weight:10,fillColor:"#F2B679",color:"#F2B679",fillOpacity:.5,strokeWeight:.7}},popUpFunction:t=>{let a;"google"===this.maptype?(a={},t.forEachProperty(function(e,t){a[t]=e})):"leaflet"===this.maptype&&(a=t.properties);let r,o,s,n=0,i=a.depth100,l=a.depth500,c=a.UtilFcltyC,p=a.Cost,d=this.scenario;"x100_year"===d?r=i:"x500_year"===d&&(r=l);for(let t in e[c])e[c][t].floodDepth===r&&(s=e[c][t].damage,o=e[c][t].utilitySystem);return n=s/100*p*1e3,JSON.stringify({"Utiltiy ID":a.WasteWater,"Utility Type":o,"Flood depth":r,Damage:parseInt(n)}).replaceAll(",","<br>").replaceAll(/|{|}/g,"")}},data:n})}const D=document.createElement("div");D.innerHTML='<div id="legend" class="content" \n    style="display: block; background: rgba(255, 255, 255, 1); padding: 2px 5px; border-style: solid !important;">\n    <b>Legend</b>\n    <br>\n    <span>&#9679;</span> Bridge\n    <br>\n    <span style="color: orange;">&#9679;</span> Utility\n    <br>\n    <span style="background-color: blue; color: blue;">&#9679;</span> Flood extent\n    <br>\n    <b>Building Damage ($)</b>\n    <br>\n    <span style="color: green;">&#9679;</span> 0 - 100k\n    <br>\n    <span style="color: yellow;">&#9679;</span> 100k - 1M\n    <br>\n    <span style="color: red;">&#9679;</span> 1M+\n    <br>\n    <b>Vehicle Damage ($)</b>\n    <br>\n    <span style="background-color: #BFBFBF; color: #BFBFBF;">&#9679;</span> 0 - 100k\n    <br>\n    <span style="background-color: #7E7E7E; color: #7E7E7E;">&#9679;</span> 100k - 1M\n    <br>\n    <span style="background-color: #323232; color: #323232;">&#9679;</span> 1M+\n  </div>',await(0,_map_map_js__WEBPACK_IMPORTED_MODULE_2__.addCustomLegend)({params:{position:"bottom left"},args:{div:D}}),_.Vehicles.Day=floodDM.formatUSDollar(_.Vehicles.Day),_.Vehicles.Night=floodDM.formatUSDollar(_.Vehicles.Night),_.Buildings.Structure=floodDM.formatUSDollar(_.Buildings.Structure),_.Buildings.Content=floodDM.formatUSDollar(_.Buildings.Content),_.Buildings.Income=floodDM.formatUSDollar(_.Buildings.Income),_.Buildings.Wage=floodDM.formatUSDollar(_.Buildings.Wage),_.Buildings["Relocation Expenses"]=floodDM.formatUSDollar(_.Buildings["Relocation Expenses"]),_.Buildings["Rental Income"]=floodDM.formatUSDollar(_.Buildings["Rental Income"]),_.Utilities.Damage=floodDM.formatUSDollar(_.Utilities.Damage),_.Buildings["Loss of Life (Day)"]=Math.floor(_.Buildings["Loss of Life (Day)"]),_.Buildings["Loss of Life (Night)"]=Math.floor(_.Buildings["Loss of Life (Day)"]);let b=floodDM.createTableFromObject({args:{obj:_}}),E=document.createElement("div");return E.appendChild(b),E.style.position="absolute",E.style.float="left",E.style.top="50px",E.style.left="50px",E.style.display="block",E.style.backgroundColor="white",E.style.fontSize="x-small",floodDM.appendCloseButton(E),document.body.appendChild(E),_}static appendCloseButton(e){const t=document.createElement("span");t.classList.add("close-btn"),t.onclick=function(){return this.parentNode.remove(),!1},Object.assign(t.style,{position:"absolute",top:"10px",right:"10px",width:"20px",height:"20px",cursor:"pointer"}),t.appendChild(document.createElement("style")).textContent="\n      .close-btn::before,\n      .close-btn::after {\n        \n      content: '';\n      position: absolute;\n      top: 50%;\n      left: 50%;\n      width: 100%;\n      height: 2px;\n      background-color: #777;\n      transform: translate(-50%, -50%) rotate(45deg);\n    \n      }\n      .close-btn::after {\n        transform: translate(-50%, -50%) rotate(-45deg);\n      }\n      .close-btn:hover::before,\n      .close-btn:hover::after {\n        \n      background-color: #000000;\n    \n      }\n    ",e.style.position="relative",e.appendChild(t)}static async getPropertyDamageFunction({params,args,data}={}){const corsProxyUrl=_data_datasources_proxy_js__WEBPACK_IMPORTED_MODULE_0__.A["local-proxy"].endpoint,propertyLossesUrl="https://hydroinformatics.uiowa.edu/lab/fidas/data/functions/business_str_cnt_inputs.js",proxyUrl=`${corsProxyUrl}${propertyLossesUrl}`;try{const response=await fetch(proxyUrl);let propertyLosses=await response.text();return eval(propertyLosses),propertyLosses}catch(e){return console.error("Error fetching property losses data:",e),null}}static async getLifeLossFunction({params,args,data}={}){const corsProxyUrl=_data_datasources_proxy_js__WEBPACK_IMPORTED_MODULE_0__.A["local-proxy"].endpoint,lifeLossesUrl="https://hydroinformatics.uiowa.edu/lab/fidas/data/functions/life_inputs.js",proxyUrl=`${corsProxyUrl}${lifeLossesUrl}`;try{const response=await fetch(proxyUrl);let life=await response.text();return eval(life),life}catch(e){return console.error("Error fetching life losses data:",e),null}}static async getDebrisWeightFunction({params,args,data}={}){const corsProxyUrl=_data_datasources_proxy_js__WEBPACK_IMPORTED_MODULE_0__.A["local-proxy"].endpoint,debrisUrl="https://hydroinformatics.uiowa.edu/lab/fidas/data/functions/debris_weight.js",proxyUrl=`${corsProxyUrl}${debrisUrl}`;try{const response=await fetch(proxyUrl);let debris=await response.text();return eval(debris),debris}catch(e){return console.error("Error fetching debris weight data:",e),null}}static async getBridgeDamageFunction({params,args,data}={}){const corsProxyUrl=_data_datasources_proxy_js__WEBPACK_IMPORTED_MODULE_0__.A["local-proxy"].endpoint,debrisUrl="https://hydroinformatics.uiowa.edu/lab/fidas/data/functions/bridge_function.js",proxyUrl=`${corsProxyUrl}${debrisUrl}`;try{const response=await fetch(proxyUrl);let bridgeDamFun=await response.text();return eval(bridgeDamFun),bridgeDamFun}catch(e){return console.error("Error fetching debris weight data:",e),null}}static async getVehicleDamageFunction({params,args,data}={}){const corsProxyUrl=_data_datasources_proxy_js__WEBPACK_IMPORTED_MODULE_0__.A["local-proxy"].endpoint,debrisUrl="https://hydroinformatics.uiowa.edu/lab/fidas/data/functions/vehicle_function.js",proxyUrl=`${corsProxyUrl}${debrisUrl}`;try{const response=await fetch(proxyUrl);let vehicleDamFun=await response.text();return eval(vehicleDamFun),vehicleDamFun}catch(e){return console.error("Error fetching debris weight data:",e),null}}static async getUtilityDamageFunction({params,args,data}={}){const corsProxyUrl=_data_datasources_proxy_js__WEBPACK_IMPORTED_MODULE_0__.A["local-proxy"].endpoint,debrisUrl="https://hydroinformatics.uiowa.edu/lab/fidas/data/functions/utility_function.js",proxyUrl=`${corsProxyUrl}${debrisUrl}`;try{const response=await fetch(proxyUrl);let utilityDamFun=await response.text();return eval(utilityDamFun),utilityDamFun}catch(e){return console.error("Error fetching debris weight data:",e),null}}async initMitigationScenario({params:e,args:t,data:a}={}){let{city:r,depth:o}=t;this.city=r,this.depth=o,void 0===e?(this.maptype="leaflet",e={}):void 0===e.maptype?this.maptype="leaflet":this.maptype=e.maptype,"google"===this.maptype&&void 0===e.key&&(this.maptype="leaflet");let s=await(0,_data_data_js__WEBPACK_IMPORTED_MODULE_1__.Je)({params:{source:"mitigation_dt",datatype:"community_flood_inundation"},args:{sourceType:this.city}}),n=await floodDM.featureCollectionCentroid(s);if(s=await floodDM.getFloodInundation({args:{depth:this.depth},data:s}),this.mapRendered||(await(0,_map_map_js__WEBPACK_IMPORTED_MODULE_2__.renderMap)({params:{maptype:this.maptype,lat:n[1],lon:n[0]},args:{key:e.key}}),this.mapRendered=!0),s.features.length>0){let e=e=>{let t,a,r="gray",o="depth"+String(Math.floor(10*this.depth));return"google"===this.maptype?(t=e.getProperty(o),a=1):"leaflet"===this.maptype&&(t=e.properties[o],a=4),5<t&&t<=10?r="purple":2<t&&t<=5?r="red":0<t&&t<=2&&(r="yellow"),{scale:5,radius:a,fillColor:r,color:"black",weight:1,opacity:1,fillOpacity:.8,strokeWeight:.7}},t=e=>{let t,a="depth"+String(Math.floor(10*this.depth));return"google"===this.maptype?(t={},e.forEachProperty(function(e,a){t[a]=e})):"leaflet"===this.maptype&&(t=e.properties),`<h4><b>Damage and Mitigation</b><br></h4>\n          <b>Building Information</b><br>\n          Building ID: ${String(t.gid)}<br>\n          Occupancy Type: ${String(t.occupancy2)}<br>\n          Flood Depth: ${t[a]} ft<br>`},a=async e=>{"google"===this.maptype?this.selectedfeature=e.feature:"leaflet"===this.maptype&&(this.selectedfeature=e.target.feature),console.log(this.selectedfeature)};await(0,_map_map_js__WEBPACK_IMPORTED_MODULE_2__.Layers)({args:{type:"geojson",name:"mygeoJSON",styleFunction:e,popUpFunction:t,onClickFunction:a},data:s})}let i=await floodDM.getCityFloodDamage({args:{depth:this.depth,city:this.city}});"Cedar Rapids"===r?(i.low_emission="$ 295.3 M",i.high_emission="$ 635.8 M"):"Cedar Falls"===r?(i.low_emission="$ 175.5 M",i.high_emission="$ 332.9 M"):"Waterloo"===r&&(i.low_emission="$ 269.2 M",i.high_emission="$ 785.6 M");let l=floodDM.createTableFromObject({args:{obj:i,tableHeaderText:this.city}}),c=document.createElement("div");c.appendChild(l),c.style.position="absolute",c.style.float="left",c.style.top="50px",c.style.left="50px",c.style.display="block",c.style.backgroundColor="white",c.style.fontSize="x-small",floodDM.appendCloseButton(c),document.body.appendChild(c);const p=document.createElement("div");return p.innerHTML='\n  <div id="legend" class="content" \n  style="display: block; background: rgba(255, 255, 255, 1); padding: 2px 5px; border-style: solid !important;">\n  ">\n    <b>LEGEND</b>\n    <br>\n    <b>Depth</b>\n    <br>\n    <span style="color: purple;">&#9632;</span> &gt; 5 - 10 ft</span>\n    <br>\n    <span style="color: red;">&#9632;</span> 2 - 5 ft</span>\n    <br>\n    <span style="color: yellow;">&#9632;</span> &lt; 2 ft</span>\n  </div>\n',await(0,_map_map_js__WEBPACK_IMPORTED_MODULE_2__.addCustomLegend)({params:{position:"bottom right"},args:{div:p}}),i}static featureCollectionCentroid(e){let t=e.features.length,a=e.features.reduce((e,t)=>[t.geometry.coordinates[0]+e[0],t.geometry.coordinates[1]+e[1]],[0,0]);return[a[0]/t,a[1]/t]}async runMitigationScenario({params:e,args:t,data:a}={}){let r,{mitigationMeasure:o,mitigationDepth:s,foundationType:n}=t;if(null===this.selectedfeature)return void console.log("Click on a property marker and then run mitigation scenario");"google"===this.maptype?(r={},this.selectedfeature.forEachProperty(function(e,t){r[t]=e})):"leaflet"===this.maptype&&(r=this.selectedfeature.properties),e={occupancy:r.occupancy2,structuralValue:r.val_struct,contentValue:r.val_cont,buildingArea:r.sqfoot},t={floodDepth:r["depth"+(10*this.depth).toString()],mitigationMeasure:o,mitigationDepth:s,foundationType:n};let i=await floodDM.buildPropertyDMScenario({params:e,args:t,data:a}),l=floodDM.createTableFromObject({args:{obj:i,tableHeaderText:"Damage and Mitigation Summary"}}),c=document.createElement("div");return c.appendChild(l),c.style.position="absolute",c.style.float="left",c.style.top="200px",c.style.left="50px",c.style.display="block",c.style.backgroundColor="white",c.style.fontSize="x-small",floodDM.appendCloseButton(c),document.body.appendChild(c),l}static async getCityFloodDamage({params:e,args:t,data:a}={}){if(!t.city||!t.depth)return"City or depth not found";const r=_data_datasources_proxy_js__WEBPACK_IMPORTED_MODULE_0__.A["local-proxy"].endpoint;let o;"Cedar Falls"===t.city?o="cedar_falls":"Cedar Rapids"===t.city?o="cedar_rapids":"Waterloo"===t.city&&(o="waterloo");const s=`${r}https://hydroinformatics.uiowa.edu/lab/midas/communities/${o}.json`;try{const e=await fetch(s);return(await e.json()).city.filter(e=>e.flood_level===t.depth.toString())[0]}catch(e){return console.error("Error fetching debris weight data:",e),null}}static createTableFromObject({params:e,args:t,data:a}={}){void 0===t.obj&&(t.obj="");let{obj:r,depth:o=0,showHeader:s=!0,tableHeaderText:n=null}=t;const i=document.createElement("table");if(i.style.borderCollapse="collapse",i.style.border="1px solid #fff",null!==n&&0===o){const e=i.insertRow().insertCell();e.textContent=n,e.style.fontWeight="bold",e.style.fontFamily="Arial",e.colSpan=2,e.style.borderRight="1px solid #000"}for(const e in r){const t=i.insertRow(),a=t.insertCell();a.textContent=e,a.style.padding="0 10px 0 10px",a.style.borderRight="1px solid #fff",a.style.backgroundColor="#337bcb",a.style.color="white",a.style.fontFamily="Arial",s&&(a.style.fontWeight="bold");const n=t.insertCell();"object"==typeof r[e]&&null!==r[e]?(n.style.borderBottom="1px solid #fff",n.style.backgroundColor="#fff",n.appendChild(floodDM.createTableFromObject({args:{obj:r[e],depth:o+1,showHeader:!0}}))):n.textContent=r[e]}return i}static getFloodInundation({params:e,args:t,data:a}={}){if(!a.features||!Array.isArray(a.features))return{error:"Invalid data format"};if(!t||"number"!=typeof t.depth)return{error:"Invalid args format"};const r=t.depth;let o=structuredClone(a);return o.features=o.features.filter(e=>e.properties["depth"+String(Math.floor(10*r))]>=1),o}static async buildPropertyDMScenario({params:e,args:t,data:a}={}){const{occupancy:r,structuralValue:o,contentValue:s,buildingArea:n}=e,{floodDepth:i,mitigationMeasure:l,mitigationDepth:c,foundationType:p}=t,d={occupancy:r,structuralValue:o,contentValue:s,buildingArea:n};if("number"==typeof i){const e=await this.fetchCurvesData(r,i),t=this.calculateLosses(o,s,e);d.floodDepth=i,d.structuralLoss=t.structuralLoss,d.contentLoss=t.contentLoss;let a=d.buildingArea;if(c&&l){const e=await this.getMitigationOptions(p,l,c,a,d);d.mitigationOptions=e}d.structuralLoss=floodDM.formatUSDollar(d.structuralLoss),d.contentLoss=floodDM.formatUSDollar(d.contentLoss),d.structuralValue=floodDM.formatUSDollar(d.structuralValue),d.contentValue=floodDM.formatUSDollar(d.contentValue)}return d}static async fetchCurvesData(e,t){const a=`${_data_datasources_proxy_js__WEBPACK_IMPORTED_MODULE_0__.A["local-proxy"].endpoint}https://hydroinformatics.uiowa.edu/lab/midas/jsons/curves.json`;let r=await fetch(a);return r=await r.json(),r.curves.filter(a=>a.occupancy===e&&a.depth===t.toString()).reduce((e,a)=>Math.abs(a.depth-t)<Math.abs(e.depth-t)?a:e)}static calculateLosses(e,t,a){const r=e*a.struct_dam_per/100,o=t*a.cont_dam_per/100;return{structuralLoss:1e3*Math.round(r/1e3),contentLoss:1e3*Math.round(o/1e3)}}static async getMitigationOptions(e,t,a,r,o){const s=await this.fetchMitigationData();let n,i;if(!s)return{error:"Failed to fetch mitigation data"};const l=s.mitigation_options;let c=o.structuralLoss,p=o.contentLoss,d=o.floodDepth;for(let o of l)t==o.measure&&o.foundation_type===e?(n=r*o.cost,n=1e3*Math.round(n/1e3),i=c+p-n,i=1e3*Math.round(i/1e3)):"Wet Floodproofing"==t&&a==o.design?(n=4*Math.sqrt(r)*o.cost,n=1e3*Math.round(n/1e3),a<d?(i=-n-c-p,i=1e3*Math.round(i/1e3)):a>=d&&(i=c+p-n-p,i=1e3*Math.round(i/1e3))):t==o.measure&&a==o.design&&("linear"==o.app_type?(n=4*Math.sqrt(r)*o.cost,n=1e3*Math.round(n/1e3),a<d?(i=-n-c-p,i=1e3*Math.round(i/1e3)):a>=d&&(i=c+p-n,i=1e3*Math.round(i/1e3))):"area"==o.app_type&&(n=r*o.cost,n=1e3*Math.round(n/1e3),a<d?(i=-n-c-p,i=1e3*Math.round(i/1e3)):a>=d&&(i=c+p-n,i=1e3*Math.round(i/1e3))));return{measure:t,foundationType:e,cost:floodDM.formatUSDollar(n),benefit:floodDM.formatUSDollar(i)}}static formatUSDollar(e){return isNaN(e)||"number"!=typeof e?"Invalid input":e.toLocaleString("en-US",{style:"currency",currency:"USD"})}static async fetchMitigationData(){const e=`${_data_datasources_proxy_js__WEBPACK_IMPORTED_MODULE_0__.A["local-proxy"].endpoint}https://hydroinformatics.uiowa.edu/lab/midas/jsons/mitigations.json`;try{const t=await fetch(e);return await t.json()}catch(e){return console.error("Error fetching mitigation data:",e),null}}static async getBridgeDamage({params,args,data}={}){const{bridge_type,scour_index,flood_scenario,replacement_value}=args,corsProxyUrl=_data_datasources_proxy_js__WEBPACK_IMPORTED_MODULE_0__.A["local-proxy"].endpoint,bridgeDamageUrl="https://hydroinformatics.uiowa.edu/lab/fidas/data/functions/bridge_function.js",proxyUrl=`${corsProxyUrl}${bridgeDamageUrl}`;try{const response=await fetch(proxyUrl),data=await response.text();let bridgeDamFun;eval(data);const matchingEntry=bridgeDamFun[bridge_type].find(e=>e.ScourPotential===scour_index&&e["Flood Scenario"]===flood_scenario);if(matchingEntry){const e=matchingEntry["damage prcnt"],t=replacement_value*e,a=replacement_value*(1-functionalPercent);return{damagePercent:e,damageCost:Math.round(t),damage}}return console.warn(`No matching entry found for bridge_type: ${bridge_type}, scour_index: ${scour_index}, and flood_scenario: ${flood_scenario}`),null}catch(e){return console.error("Error fetching bridge damage data:",e),null}}static async getUtilityDamage({params,args,data}={}){const{utility,depth,utilityValue}=args,corsProxyUrl=_data_datasources_proxy_js__WEBPACK_IMPORTED_MODULE_0__.A["local-proxy"].endpoint,utilityDamageUrl="https://hydroinformatics.uiowa.edu/lab/fidas/data/functions/utility_function.js",proxyUrl=`${corsProxyUrl}${utilityDamageUrl}`;try{const response=await fetch(proxyUrl),data=await response.text();let utilityDamFun;eval(data);const matchingEntry=utilityDamFun[utility].find(e=>e.floodDepth===depth);if(matchingEntry){const e=matchingEntry.damage,t=utilityValue*(e/100);return{damagePercent:e,damageCost:Math.round(t)}}return console.warn(`No matching entry found for utility: ${utility} and depth: ${depth}`),null}catch(e){return console.error("Error fetching utility damage data:",e),null}}static async getPropertyLoss({params,args,data}={}){const{occupancy,depth,foundationType,structureValue,contentValue,area}=args,corsProxyUrl=_data_datasources_proxy_js__WEBPACK_IMPORTED_MODULE_0__.A["local-proxy"].endpoint;let propertyLosses,debris;const propertyLossesUrl="https://hydroinformatics.uiowa.edu/lab/fidas/data/functions/business_str_cnt_inputs.js",debrisUrl="https://hydroinformatics.uiowa.edu/lab/fidas/data/functions/debris_weight.js",[propertyLossesData,debrisData]=await Promise.all([fetch(`${corsProxyUrl}${propertyLossesUrl}`).then(e=>e.text()),fetch(`${corsProxyUrl}${debrisUrl}`).then(e=>e.text())]);eval(propertyLossesData),eval(debrisData);const propertyLossEntry=propertyLosses[occupancy].find(e=>e.floodDepth===depth),debrisEntry=debris[occupancy].find(e=>e.floodDepth===depth&&e.foundationType===foundationType);if(propertyLossEntry&&debrisEntry){const e=propertyLossEntry.structure,t=propertyLossEntry.content,a=structureValue*e/100,r=contentValue*t/100,o=propertyLossEntry.incomePerSqftPerDay*area,s=propertyLossEntry.wagePerSqftPerDay*area,n=(1-propertyLossEntry.percentOwnerOccupied/100)*area*propertyLossEntry.rentalCostPerSqftPerDay*propertyLossEntry.maxTime*30/1e3,i=area*((1-propertyLossEntry.percentOwnerOccupied/100)*propertyLossEntry.disruptionCostPerSqft+propertyLossEntry.percentOwnerOccupied/100*(propertyLossEntry.disruptionCostPerSqft+propertyLossEntry.rentalCostPerSqftPerDay*propertyLossEntry.maxTime*30))/1e3,l=area*debrisEntry.finishes/1e3,c=area*debrisEntry.structure/1e3,p=area*debrisEntry.foundation/1e3,d=l+c+p;return{propertyLoss:{structureLoss:Math.round(a),contentLoss:Math.round(r),structureDamPercent:e,contentDamPercent:t},businessInterruption:{incomeLoss:Math.round((1-propertyLossEntry.recapturFactor)*o*30)*propertyLossEntry.maxTime,wageLoss:Math.round((1-propertyLossEntry.recapturFactor)*s*30)*propertyLossEntry.maxTime,rentalIncome:Math.round(n),relocation:Math.round(i)},debrisAmount:{finishesDebris:Math.round(l),structureDebris:Math.round(c),foundationDebris:Math.round(p),totalDebris:Math.round(d)}}}return console.warn(`No matching entry found for occupancy: ${occupancy}, depth: ${depth}, and foundationType: ${foundationType}`),null}static async getLifeLoss({params,args,data}={}){const{occupancy,depth,peopleOver65,peopleUnder65}=args,corsProxyUrl=_data_datasources_proxy_js__WEBPACK_IMPORTED_MODULE_0__.A["local-proxy"].endpoint,lifeLossUrl="https://hydroinformatics.uiowa.edu/lab/fidas/data/functions/life_inputs.js",proxyUrl=`${corsProxyUrl}${lifeLossUrl}`;try{const response=await fetch(proxyUrl),data=await response.text();let life;eval(data);const matchingEntryOver65=life[occupancy].find(e=>e.floodDepth===depth&&"over 65"===e.age),matchingEntryUnder65=life[occupancy].find(e=>e.floodDepth===depth&&"under 65"===e.age);if(matchingEntryOver65||matchingEntryUnder65)return{lifeLossOver65:parseInt(matchingEntryOver65.zone*peopleOver65),lifeLossUnder65:parseInt(matchingEntryUnder65.zone*peopleUnder65)}}catch(e){return console.error("Error fetching utility damage data:",e),null}}static async getVehicleDamage({params,args,data}={}){const{floodDepth,vehicleType,vehicleCount,vehicleValue}=args,corsProxyUrl=_data_datasources_proxy_js__WEBPACK_IMPORTED_MODULE_0__.A["local-proxy"].endpoint,vehicleDamageUrl="https://hydroinformatics.uiowa.edu/lab/fidas/data/functions/vehicle_function.js",proxyUrl=`${corsProxyUrl}${vehicleDamageUrl}`;try{const response=await fetch(proxyUrl),data=await response.text();let vehicleDamFun;eval(data);const matchingEntry=vehicleDamFun[vehicleType].find(e=>e.floodDepth===floodDepth);if(matchingEntry){const e=matchingEntry.damage,t=vehicleValue*(e/100)*vehicleCount;return{damagePercent:e,damage:Math.round(t)}}return console.warn(`No matching entry found for vehicleType: ${vehicleType} and floodDepth: ${floodDepth}`),null}catch(e){return console.error("Error fetching vehicle damage data:",e),null}}}},243:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Je:()=>retrieve});var _datasources_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(903),_utils_data_cache_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(526),_utils_index_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(625);async function retrieve({params,args,data}={}){let source=params.source,dataType=params.datatype,placeHolder=params.placeHolder||!1,trans=params.transform||!1;globalThis._hydroCacheContext={source,dataset:args.dataset||source,dataType,cacheId:params.cacheId,params:args,cache:!1!==params.cache,useChunkedDownload:!0===params.chunked||"auto"===params.chunked};try{const griddedConfig=_utils_index_js__WEBPACK_IMPORTED_MODULE_2__.TO[source];if(griddedConfig){if(griddedConfig.preProcess){const e=await griddedConfig.preProcess(params,args,dataType);args=e.args}return!0!==params.process&&(args.process=!1),(0,_utils_index_js__WEBPACK_IMPORTED_MODULE_2__.og)(source,dataType,args,_datasources_js__WEBPACK_IMPORTED_MODULE_0__)}let dataSource=_datasources_js__WEBPACK_IMPORTED_MODULE_0__[source]?.[dataType];if(!dataSource)return Promise.reject(new Error("No data source found for the given specifications."));let endpoint="waterOneFlow"===source||"hisCentral"===source||"mitigation_dt"===source||"flooddamage_dt"===source||"nldas"===source||"dwd"===source||"chirps"===source?"nldas"===source?_datasources_js__WEBPACK_IMPORTED_MODULE_0__[source].sourceType(args.dataset,dataType,args):"dwd"===source||"chirps"===source?_datasources_js__WEBPACK_IMPORTED_MODULE_0__[source].sourceType(args,dataType):_datasources_js__WEBPACK_IMPORTED_MODULE_0__[source].sourceType(args.sourceType,dataType):dataSource.endpoint,type=params.type||dataSource.methods.type,proxy="";if(_datasources_js__WEBPACK_IMPORTED_MODULE_0__[source]?.requirements?.needProxy){const e=params.proxyServer||"local-proxy";proxy=_datasources_js__WEBPACK_IMPORTED_MODULE_0__.proxies[e]?.endpoint||_datasources_js__WEBPACK_IMPORTED_MODULE_0__.proxies["local-proxy"].endpoint}let headers={"content-type":"json"===type?"application/json":"xml"===type||"soap"===type?"text/xml; charset=utf-8":"csv"===type||"tab"===type?"application/text":"netcdf"===type||"tiff"===type||"image"===type||"blob"===type?"application/octet-stream":"application/json"};"soap"===type&&(headers.SOAPAction=_datasources_js__WEBPACK_IMPORTED_MODULE_0__[source].action+dataType);let keyname=_datasources_js__WEBPACK_IMPORTED_MODULE_0__[source]?.requirements?.keyname;keyname&&params[keyname]?headers[keyname]=params[keyname]:keyname&&console.warn("info: please verify the keyname of the source."),endpoint=endpoint.replace(/{(\w+)}/g,(e,t)=>{const a=args[t];return delete args[t],a});let fetchOptions={method:dataSource.methods.method||"GET",headers};if("POST"===fetchOptions.method)"json"===type?fetchOptions.body=JSON.stringify(args):"soap"!==type&&"xml"!==type||(fetchOptions.body=Object.keys(args).length?_datasources_js__WEBPACK_IMPORTED_MODULE_0__.envelope(dataSource.body(args)):_datasources_js__WEBPACK_IMPORTED_MODULE_0__.envelope(dataSource.body()));else if("GET"===fetchOptions.method){const e={};if(dataSource.params){for(const[t,a]of Object.entries(dataSource.params))null!=a&&(e[t]=a);for(const[t,a]of Object.entries(args))null!=a&&(e[t]=a)}else Object.assign(e,args);if(Object.keys(e).length>0){const t=new URLSearchParams(e).toString();endpoint+=`?${t}`}}return(0,_utils_data_cache_js__WEBPACK_IMPORTED_MODULE_1__.cachedFetch)(proxy+endpoint,fetchOptions).then(async e=>{if("function"==typeof e.clone){const t=e.clone();try{const e=await t.text();console.log(`[Retrieve Debug] Raw response from ${proxy+endpoint}:`,e.substring(0,500))}catch(e){console.log("[Retrieve Debug] Failed to read raw response:",e)}}else console.log(`[Retrieve Debug] Response from ${proxy+endpoint} is not a standard Response object (no clone method).`);if("function"!=typeof e.text){if(e instanceof ArrayBuffer||void 0!==e.byteLength){const t=(new TextDecoder).decode(e);return"json"===params.datatype||"json"===dataSource.methods.type?JSON.parse(t):t}return e}if(!e||void 0===e.ok||void 0===e.headers){if("json"===type&&"string"==typeof e)try{return JSON.parse(e)}catch(t){return e}return["blob","netcdf","grib2","tiff","image"].includes(type)?new Blob([e]):e}if(!e.ok){const t=await e.text();throw new Error(`HTTP error ${e.status} fetching ${endpoint}: ${t}`)}if(!0!==params.process){const t=e.headers.get("content-type");return t&&(t.includes("application/json")||t.includes("text/"))?e.text():e.blob()}let t=type||dataSource.methods.type||"unknown";if(["netcdf","grib2","tiff","image","blob","zip","tar","kmz","zarr","binary"].includes(t))return"function"==typeof e.blob?e.blob():"function"==typeof e.arrayBuffer?e.arrayBuffer().then(e=>new Blob([e])):new Blob([e]);if("json"===t){const t=e.headers.get("content-type");return t&&(t.includes("image/")||t.includes("application/octet-stream")||t.includes("application/x-tar")||t.includes("application/zip"))?"function"==typeof e.blob?e.blob():e.arrayBuffer().then(e=>new Blob([e])):e.json()}if(["xml","soap","csv","tab","kml"].includes(t))return e.text();const a=e.headers.get("content-type")||"";return a.includes("application/json")?e.json():a.includes("text/")||a.includes("xml")||a.includes("application/vnd.google-earth.kml+xml")?e.text():e.blob()}).then(responseData=>{if(!0!==params.process)return responseData;if("soap"===type)try{return responseData}catch(e){throw new Error(`Error parsing SOAP response from ${endpoint}: ${e.message}`)}else{if("xml"===type||"tab"===type||"CSV"===type)return JSON.stringify(responseData);if(!trans)return lowercasing(responseData);if("usgs"===source)return transform({params:{save:"value"},args:{keep:'["datetime", "value"]',type:"ARR"},data:lowercasing(responseData)});if("eval"===trans)return eval(responseData)}})}finally{}}async function getFile({params:e,args:t,data:a}={}){const r=globalThis.hydro?.cache;if(!r)throw new Error("Cache not available");const o=t.key;if(!o)throw new Error("Cache key required in args.key");const s=await r.get(o);if(!s)throw new Error(`No cached file found with key: ${o}`);return{data:s.data,metadata:s.metadata,key:o,raw:!0}}async function saveFile({params:e,args:t,data:a}={}){const r=globalThis.hydro?.cache;if(!r)throw new Error("Cache not available");const o=t.key;if(!o)throw new Error("Dataset key required in args.key");if(!a)throw new Error("Data to save is required");const s={source:e.source||"user",datatype:e.datatype||"dataset",name:t.name||o,savedAt:(new Date).toISOString(),userSaved:!0};return await r.saveDataset(o,a,s)}const transformGriddedData=({params:e,args:t,data:a})=>{console.log("[transform] Processing gridded data transformation");const r=e?.source||"generic";if(a&&"object"==typeof a&&!a.variable&&!Array.isArray(a)){const o={};for(const[s,n]of Object.entries(a))try{o[s]=transformVariable(s,n,r,e,t)}catch(e){console.warn(`Failed to transform ${s}: ${e.message}`),o[s]={error:e.message}}return o}{const o=a.variable||Object.keys(a)[0];return transformVariable(o,a,r,e,t)}},transformVariable=(e,t,a,r,o)=>{let s=deepClone(t);return"aorc"===a?s=(0,_utils_index_js__WEBPACK_IMPORTED_MODULE_2__.AV)(s,e,_datasources_js__WEBPACK_IMPORTED_MODULE_0__,"aorc"):"nwm"===a?s=(0,_utils_index_js__WEBPACK_IMPORTED_MODULE_2__.AV)(s,e,_datasources_js__WEBPACK_IMPORTED_MODULE_0__,"nwm"):"threedep"===a?s=(0,_utils_index_js__WEBPACK_IMPORTED_MODULE_2__.AV)(s,e,_datasources_js__WEBPACK_IMPORTED_MODULE_0__,"threedep"):"prism"===a&&(s=(0,_utils_index_js__WEBPACK_IMPORTED_MODULE_2__.AV)(s,e,_datasources_js__WEBPACK_IMPORTED_MODULE_0__,"prism")),o?.units&&(s=(0,_utils_index_js__WEBPACK_IMPORTED_MODULE_2__.vq)(s,e,o.units,a,_datasources_js__WEBPACK_IMPORTED_MODULE_0__)),o?.temporalAggregation&&(s=(0,_utils_index_js__WEBPACK_IMPORTED_MODULE_2__.k4)(s,o.temporalAggregation)),o?.spatialAggregation&&(s=aggregateSpatial(s,o.spatialAggregation)),o?.qualityControl&&(s=(0,_utils_index_js__WEBPACK_IMPORTED_MODULE_2__.nR)(s,o.qualityControl)),o?.statistics&&(s=(0,_utils_index_js__WEBPACK_IMPORTED_MODULE_2__.G_)(s,o.statistics)),o?.type?(0,_utils_index_js__WEBPACK_IMPORTED_MODULE_2__.Yw)(s,o,a,_datasources_js__WEBPACK_IMPORTED_MODULE_0__):s};function transform({params:e,args:t,data:a}={}){function r(e){if(null===e||"object"!=typeof e)return e;if(e instanceof Date)return new Date(e.getTime());if(Array.isArray(e))return e.map(r);const t={};for(const a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=r(e[a]));return t}const o=e=>"string"!=typeof e||isNaN(e)||""===e.trim()?e:Number(e),s=e=>{if(Array.isArray(e))return e.map(e=>s(e));if("object"==typeof e&&null!==e){const t={};for(const a in e)t[a]=s(e[a]);return t}return o(e)},n=e=>{if("string"==typeof e){const t=new Date(e);if(!isNaN(t.getTime()))return t;if("true"===e.toLowerCase()||"false"===e.toLowerCase())return"true"===e.toLowerCase()}return e},i=(e,t)=>t.split(".").reduce((e,t)=>e?.[t],e),l=(e,t="",a={})=>{for(const r in e){const o=e[r],s=t?`${t}.${r}`:r;"object"!=typeof o||null===o||Array.isArray(o)?a[s]=o:l(o,s,a)}return a};if(console.log("[transform] Original input data:",a),a=r(a),"aorc"===e?.source||"nwm"===e?.source||"threedep"===e?.source||"prism"===e?.source||a&&"object"==typeof a&&a.variable)return transformGriddedData({params:e,args:t,data:a});if(e){if(void 0!==e.save&&void 0===t){const t=recursiveSearch({obj:a,searchkey:e.save});a=t?.[0]}else if(void 0!==e.save&&void 0!==t.keep){const r=recursiveSearch({obj:a,searchkey:e.save});if(a=r?.[0],!a)return null;t.parse&&(a=s(a)),"string"==typeof t.keep&&(t.keep=JSON.parse(t.keep));const o=new RegExp(t.keep.join("|"));if(Array.isArray(a))a=a.map(e=>{if("object"!=typeof e)return e;const t={};for(const a in e)o.test(a)&&(t[a]=e[a]);return t});else if("object"==typeof a&&null!==a){const e={};for(const t in a)o.test(t)&&(e[t]=a[t]);a=e}}else if(void 0!==e.save&&void 0===t.keep){const r=recursiveSearch({obj:a,searchkey:e.save});a=r?.[0],a=t?.parse?s(a):a}}else a=t?.parse?s(a):a;if(void 0!==t?.pick&&Array.isArray(a)&&Array.isArray(a[0])){const e=Number(t.pick);!isNaN(e)&&a.length>e&&(a=a[e])}if("flatten"===t?.mode){if(Array.isArray(a)&&Array.isArray(a[0])&&"string"==typeof a[0][0]&&a[0].length>1)return a[0].slice(1).map(o);if(Array.isArray(a))return a.map(o).filter(e=>"number"==typeof e&&!isNaN(e))}if("flatten-objects"===t?.mode&&(Array.isArray(a)&&"object"==typeof a[0]?a=a.map(l):"object"==typeof a&&(a=l(a))),Array.isArray(a)&&t?.keep){const e=t.keep;a=a.map(t=>{const a={};for(const r of e)a[r.includes(".")?r.split(".").pop():r]=i(t,r);return a})}const c=t?.type;let p;if(Array.isArray(a)&&(p=r(a),t?.keep)){const e=new RegExp(t.keep.join("|"));for(let t=0;t<p.length;t++)for(const a in p[t])e.test(a)||delete p[t][a]}if("ARR"===c){if(!p||!Array.isArray(p))return console.error("[transform] arr is undefined or not an array:",p),null;let e;e=t.keep&&Array.isArray(t.keep)?t.keep:p.length>0?Object.keys(p[0]).sort():[];const a=p.map(a=>e.map(e=>t.parse?n(a[e]):a[e])),r=Array(a[0]?.length||0).fill(0).map(()=>Array(a.length).fill(0));for(let e=0;e<a[0]?.length;e++)for(let t=0;t<a.length;t++)r[e][t]=a[t][e];if(!1!==t.attachNames)for(let t=0;t<r.length;t++)e[t]&&r[t].unshift(e[t]);return r}if("ARR-col"===c)return p&&Array.isArray(p)?t.keep.map(e=>{const a=[];!1!==t.attachNames&&a.push(e);for(let r=0;r<p.length;r++){const o=p[r]?.[e];a.push(t.parse?n(o):o)}return a}):null;if("CSV"===c){if(!p||!Array.isArray(p))return console.error("[transform] CSV conversion failed: arr is invalid"),null;let e="";for(let t=0;t<p.length;t++){let a="";for(const e in p[t])""!==a&&(a+=","),a+=`"${p[t][e]}"`;e+=a+"\r\n"}return e}if("JSON"===c)return JSON.stringify(a);if("XML2JSON"===c){const e=t=>{const a={};for(const r of t.matchAll(/(?:<(\w*)(?:\s[^>]*)*>)((?:(?!<\1).)*)(?:<\/\1>)|<(\w*)(?:\s*)*\/>/gm)){const t=r[1]||r[3],o=r[2]&&e(r[2]);a[t]=o&&Object.keys(o).length?o:r[2]||null}return a};return e(a)}if(c)throw new Error("Please select a supported data conversion type!");return a}async function upload({params:e,args:t,data:a}={}){const r=document.createElement("input");r.type="file",r.accept=e.type;let o=null;const s=e=>/^-?\d+\.?\d*$/.test(e);return r.addEventListener("change",async t=>{const a=t.target.files[0],r=await(e=>new Promise((t,a)=>{const r=new FileReader;r.onload=()=>t(r.result),r.onerror=()=>a(r.error),r.readAsText(e)}))(a);if("CSV"===e.type){const e=r.split(/\r\n|\n/).map(e=>e.split(",").map(e=>e.replace(/^"|"$/g,""))),t=e[0].map((t,a)=>e.map(e=>e[a]));o=[],t.forEach((e,t)=>{e.every(s)?o.push(e.map(e=>parseFloat(e))):o.push(e)})}else"JSON"===e.type?o=JSON.parse(r):"KML"===e.type&&(o=r)}),r.click(),new Promise(e=>{const t=setInterval(()=>{null!==o&&(clearInterval(t),e(o))},100)})}async function download({params:e,args:t,data:a}={}){let{type:r}=t,o=null,s=null;const{fileName:n}=e||generateDateString();if("CSV"===r){const r=this.transform({params:e,args:t,data:await a});o=new Blob([r],{type:"text/csv; charset=utf-8;"}),s=`${n}.csv`}else if("JSON"===r){let r;r=Array.isArray(a)?this.transform({params:e,args:t,data:a}):a,o=new Blob([JSON.stringify(await r)],{type:"text/json"}),s=`${n}.json`}if(navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(o,s);else{const e=document.createElement("a");e.href=URL.createObjectURL(o),e.download=s,e.click(),e.remove()}}function recursiveSearch({obj:e,searchkey:t,results:a=[]}={}){const r=a;return Object.keys(e).forEach(a=>{const o=e[a];a===t&&Array.isArray(o)?r.push(o):"object"==typeof o&&null!==o&&recursiveSearch({obj:o,searchkey:t,results:r})}),r}function lowercasing(e){return"object"!=typeof e?e:Array.isArray(e)?e.map(lowercasing):Object.keys(e).reduce((t,a)=>{let r=e[a],o="object"==typeof r&&null!==r?lowercasing(r):r;return t[a.toLowerCase()]=o,t},{})}function xml2json(e){try{let t={};if(e.attributes&&e.attributes.length>0)for(let a=0;a<e.attributes.length;a++){const r=e.attributes.item(a);t[`@${r.nodeName}`]=r.nodeValue}for(let a=0;a<e.childNodes.length;a++){const r=e.childNodes[a];if(r.nodeType===Node.TEXT_NODE){const e=r.textContent.trim();e.length>0&&(t["#text"]=e)}else if(r.nodeType===Node.ELEMENT_NODE){const e=r.nodeName,a=xml2json(r);void 0===t[e]?t[e]=a:(Array.isArray(t[e])||(t[e]=[t[e]]),t[e].push(a))}}return 0===Object.keys(t).length&&e.textContent&&e.textContent.trim().length>0?e.textContent.trim():t}catch(e){return console.error("[xml2json] Error during conversion:",e.message),null}}function generateDateString(){const e=new Date;return`${e.getFullYear().toString().slice(-2)}.${(e.getMonth()+1).toString().padStart(2,"0")}.${e.getDate().toString().padStart(2,"0")}.${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`}const cache={async list(e={}){const t=globalThis._hydroCache;return t?await t.list(e):(console.warn("Cache not initialized"),[])},async get(e){const t=globalThis._hydroCache;return t?await t.get(e):(console.warn("Cache not initialized"),null)},async delete(e){const t=globalThis._hydroCache;return t?(await t.delete(e),!0):(console.warn("Cache not initialized"),!1)},async clear(){const e=globalThis._hydroCache;return e?(await e.clear(),!0):(console.warn("Cache not initialized"),!1)},async stats(){const e=globalThis._hydroCache;if(!e)return console.warn("Cache not initialized"),{totalSize:0,totalEntries:0,sizeFormatted:"0 B"};const t=await e.list({includeVariables:!0}),a=t.reduce((e,t)=>e+t.size,0);return{totalSize:a,totalEntries:t.length,sizeFormatted:e.formatBytes(a),entries:t}}};var __WEBPACK_DEFAULT_EXPORT__={retrieve,transform,download,upload,recursiveSearch,xml2json,getFile,saveFile}}};